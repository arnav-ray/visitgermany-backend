<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Germany for Parents: A Friendly Guide</title>
    <meta name="description" content="A fun and practical German guide for Indian parents visiting Germany, with audio and multiple Indian language translations.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f7f9fc;
            --card-bg-color: #ffffff;
            --text-color: #3d4a5c;
            --header-text-color: #2c3e50;
            --subtle-text-color: #8492a6;
            --border-color: #e0e6ed;
            --shadow-color: rgba(44, 62, 80, 0.1);
            --primary-accent: #367CFF;
            --secondary-accent: #34D399;
            --lang1-accent: #F97316;
            --lang2-accent: #10B981;
            --font-primary: 'Nunito Sans', sans-serif;
            --font-headings: 'Poppins', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-primary); line-height: 1.7; color: var(--text-color); background-color: var(--bg-color); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        header { text-align: center; margin-bottom: 40px; }
        header h1 { color: var(--header-text-color); font-family: var(--font-headings); font-size: 2.8em; margin-bottom: 10px; font-weight: 700; }
        header p { color: var(--subtle-text-color); font-size: 1.25em; max-width: 750px; margin: 0 auto; }

        .main-nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; }
        .nav-tab { padding: 12px 25px; font-size: 1.1em; font-weight: 600; font-family: var(--font-headings); cursor: pointer; border: 2px solid transparent; background: var(--card-bg-color); color: var(--subtle-text-color); border-radius: 50px; transition: all 0.3s ease; box-shadow: 0 2px 5px var(--shadow-color); }
        .nav-tab.active { color: #fff; background-color: var(--primary-accent); border-color: var(--primary-accent); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(54, 124, 255, 0.3); }
        .nav-tab:not(.active):hover { transform: translateY(-2px); color: var(--header-text-color); }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .controls { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 30px; padding: 20px; background: var(--card-bg-color); border-radius: 16px; box-shadow: 0 5px 20px var(--shadow-color); }
        .search-container { flex-grow: 1; min-width: 250px; }
        .search-input { width: 100%; padding: 15px 25px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); border-radius: 50px; font-size: 1.1em; transition: all 0.3s ease; }
        .search-input:focus { outline: none; border-color: var(--primary-accent); box-shadow: 0 0 0 4px rgba(54, 124, 255, 0.2); }
        .filter-group { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; }
        .language-select, .category-filter { padding: 15px 20px; border-radius: 50px; border: 1px solid var(--border-color); background-color: #fff; font-size: 1.1em; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%238492a6' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 1rem center; padding-right: 2.5rem; }
        
        .phrase-cards-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 25px; }
        .phrase-card { background: var(--card-bg-color); border-radius: 16px; box-shadow: 0 5px 20px var(--shadow-color); padding: 25px; display: flex; flex-direction: column; gap: 20px; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .phrase-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(44, 62, 80, 0.15); }
        
        .german-section { display: flex; justify-content: space-between; align-items: flex-start; gap: 15px; }
        .german-phrase { font-size: 1.4em; font-weight: 600; color: var(--header-text-color); line-height: 1.4; }
        .audio-btn { background: var(--secondary-accent); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 1.5em; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; flex-shrink: 0; }
        .audio-btn:hover { background: #25a97a; transform: scale(1.1); }
        
        .english-translation { font-size: 1.1em; color: var(--subtle-text-color); font-style: italic; }
        .translation-divider { border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), var(--border-color), rgba(0, 0, 0, 0)); }

        .language-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .lang-box { min-height: 100px; position: relative; }
        .lang-box h3 { font-size: 1.2em; font-family: var(--font-headings); margin-bottom: 8px; }
        .lang-box .translation { font-size: 1.2em; font-weight: 600; }
        .lang-box .pronunciation { font-size: 1em; color: var(--subtle-text-color); font-style: italic; }
        .lang1-text { color: var(--lang1-accent); }
        .lang2-text { color: var(--lang2-accent); }
        .lang-box .loader { font-size: 0.9em; color: var(--subtle-text-color); }
        
        .content-card { background-color: var(--card-bg-color); padding: 30px 40px; border-radius: 16px; box-shadow: 0 5px 20px var(--shadow-color); }
        #loading, #error, #no-results { text-align: center; padding: 60px; font-size: 1.2em; color: var(--subtle-text-color); }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Germany for Parents</h1>
            <p>A friendly guide to help you feel at home, with audio and multiple Indian language translations.</p>
        </header>

        <nav class="main-nav">
            <button class="nav-tab active" data-page="phrasebook-page">üó£Ô∏è Phrasebook</button>
            <button class="nav-tab" data-page="frankfurt-guide-page">‚úàÔ∏è Frankfurt Guide</button>
            <button class="nav-tab" data-page="tips-page">üí° Tips & Tricks</button>
        </nav>

        <main>
            <div id="phrasebook-page" class="page active">
                <div class="controls">
                    <div class="search-container">
                        <input type="text" id="search-input" class="search-input" placeholder="üîé Search...">
                    </div>
                    <div class="filter-group">
                        <select id="category-filter" class="category-filter"><option value="all">All Topics</option></select>
                        <select id="lang1-select" class="language-select" aria-label="Select first language"></select>
                        <select id="lang2-select" class="language-select" aria-label="Select second language"></select>
                    </div>
                </div>
                <div id="loading"><p>Loading phrases...</p></div>
                <div id="error" style="display: none;"><p>Could not load phrases.</p></div>
                <div id="no-results" style="display: none;"><p>No phrases match your search.</p></div>
                <div id="phrase-cards-container" class="phrase-cards-container"></div>
            </div>
            <div id="frankfurt-guide-page" class="page">
                <div class="content-card"><h2>Your Guide to Frankfurt am Main</h2><p>Content for Frankfurt...</p></div>
            </div>
            <div id="tips-page" class="page">
                <div class="content-card"><h2>Helpful Tips for Your Stay</h2><p>Content for tips...</p></div>
            </div>
        </main>
    </div>

    <script>
        const config = {
            // Get your Sheet ID from the URL of your Google Sheet
            sheetId: '1pZ7KKoCN6jdvcpNUIdR903X_eyDXJN0aEoXR1T85F8U', 
            // Get this from your Google Cloud Console under "APIs & Services > Credentials"
            apiKey: 'AIzaSyAA8HGLU2R0txJLZE3Wta7nwLKB-unKuXg', 
            sheetName: 'Sheet1',
            // Get this from the main page of your Cloud Run service
            cloudFunctionUrl: 'https://visitgermany-backend-946705852775.europe-west3.run.app' 
        };

        const supportedLanguages = {
            'hi': 'Hindi', 'bn': 'Bengali', 'mr': 'Marathi', 'gu': 'Gujarati',
            'ta': 'Tamil', 'te': 'Telugu', 'kn': 'Kannada', 'ml': 'Malayalam'
        };

        let allPhrases = [];
        let categories = new Set();
        const synth = window.speechSynthesis;
        let currentPhrases = [];

        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const noResultsEl = document.getElementById('no-results');
        const cardsContainerEl = document.getElementById('phrase-cards-container');
        const searchInputEl = document.getElementById('search-input');
        const categoryFilterEl = document.getElementById('category-filter');
        const lang1SelectEl = document.getElementById('lang1-select');
        const lang2SelectEl = document.getElementById('lang2-select');
        const navTabs = document.querySelectorAll('.nav-tab');
        const pages = document.querySelectorAll('.page');

        document.addEventListener('DOMContentLoaded', async () => {
            setupEventListeners();
            populateLanguageDropdowns();
            try {
                const data = await fetchSheetData();
                allPhrases = parseSheetData(data.values);
                if (allPhrases.length > 0) {
                    populateCategoryFilter();
                    filterAndDisplayPhrases();
                    loadingEl.style.display = 'none';
                } else {
                    throw new Error("No 'Published' phrases found in the sheet.");
                }
            } catch (err) {
                console.error("Initialization Error:", err);
                loadingEl.style.display = 'none';
                errorEl.style.display = 'block';
                errorEl.querySelector('p').textContent = `Error: ${err.message}`;
            }
        });

        async function fetchSheetData() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.sheetId}/values/${config.sheetName}?key=${config.apiKey}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
        }

        function parseSheetData(rows) {
            if (!rows || rows.length < 2) return [];
            const headers = rows[0].map(h => h.trim());
            const requiredHeaders = ['German_Phrase_Clean', 'Color_Coded_German', 'English_Translation', 'Category', 'Status'];
            const headerIndices = {};
            requiredHeaders.forEach(h => headerIndices[h] = headers.indexOf(h));

            const parsedData = [];
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (row[headerIndices.Status] === 'Published') {
                    const phrase = {
                        germanClean: row[headerIndices.German_Phrase_Clean],
                        germanStyled: row[headerIndices.Color_Coded_German],
                        english: row[headerIndices.English_Translation],
                        category: row[headerIndices.Category],
                    };
                    parsedData.push(phrase);
                    categories.add(phrase.category);
                }
            }
            return parsedData;
        }

        function renderBaseCards(phrases) {
            cardsContainerEl.innerHTML = '';
            noResultsEl.style.display = phrases.length === 0 ? 'block' : 'none';
            
            const lang1Code = lang1SelectEl.value;
            const lang2Code = lang2SelectEl.value;
            const lang1Name = supportedLanguages[lang1Code];
            const lang2Name = supportedLanguages[lang2Code];

            phrases.forEach((p, index) => {
                const card = document.createElement('div');
                card.className = 'phrase-card';
                card.dataset.index = index;
                card.innerHTML = `
                    <div class="german-section">
                        <div class="german-phrase">${p.germanStyled}</div>
                        <button class="audio-btn" aria-label="Play audio">üîä</button>
                    </div>
                    <div class="english-translation">${p.english}</div>
                    <hr class="translation-divider">
                    <div class="language-grid">
                        <div class="lang-box" id="lang1-box-${index}">
                            <h3 class="lang1-text">${lang1Name}</h3>
                            <div class="loader">Loading...</div>
                        </div>
                        <div class="lang-box" id="lang2-box-${index}">
                            <h3 class="lang2-text">${lang2Name}</h3>
                            <div class="loader">Loading...</div>
                        </div>
                    </div>
                `;
                card.querySelector('.audio-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    speak(p.germanClean);
                });
                cardsContainerEl.appendChild(card);
            });
        }

        async function fetchAndPopulateTranslations(phrases, langCode, boxIdPrefix, textClass) {
            for (let i = 0; i < phrases.length; i++) {
                const p = phrases[i];
                const box = document.getElementById(`${boxIdPrefix}-${i}`);
                if (!box) continue;

                try {
                    const response = await fetch(config.cloudFunctionUrl, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ text: p.germanClean, targetLang: langCode })
                    });
                    if (!response.ok) throw new Error('API request failed');
                    const data = await response.json();
                    
                    box.innerHTML = `
                        <h3 class="${textClass}">${supportedLanguages[langCode]}</h3>
                        <div class="translation ${textClass}">${data.translation}</div>
                        <div class="pronunciation">${data.phonetic}</div>
                    `;
                } catch (err) {
                    box.innerHTML = `<h3 class="${textClass}">${supportedLanguages[langCode]}</h3><div class="loader">Error loading.</div>`;
                    console.error(`Failed to fetch translation for "${p.germanClean}" to ${langCode}:`, err);
                }
            }
        }

        function filterAndDisplayPhrases() {
            const searchTerm = searchInputEl.value.toLowerCase().trim();
            const selectedCategory = categoryFilterEl.value;
            currentPhrases = allPhrases.filter(p => {
                const matchesCategory = selectedCategory === 'all' || p.category === selectedCategory;
                const matchesSearch = searchTerm === '' ||
                    p.germanClean.toLowerCase().includes(searchTerm) ||
                    p.english.toLowerCase().includes(searchTerm);
                return matchesCategory && matchesSearch;
            });
            
            renderBaseCards(currentPhrases);

            if (config.cloudFunctionUrl === 'YOUR_NEW_CLOUD_RUN_URL_HERE') {
                errorEl.style.display = 'block';
                errorEl.querySelector('p').textContent = 'Error: Please update the cloudFunctionUrl in the index.html file.';
                return;
            }

            fetchAndPopulateTranslations(currentPhrases, lang1SelectEl.value, 'lang1-box', 'lang1-text');
            fetchAndPopulateTranslations(currentPhrases, lang2SelectEl.value, 'lang2-box', 'lang2-text');
        }

        function populateCategoryFilter() {
            const sortedCategories = [...categories].sort();
            sortedCategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categoryFilterEl.appendChild(option);
            });
        }

        function populateLanguageDropdowns() {
            Object.entries(supportedLanguages).forEach(([code, name]) => {
                lang1SelectEl.add(new Option(name, code));
                lang2SelectEl.add(new Option(name, code));
            });
            lang1SelectEl.value = 'hi';
            lang2SelectEl.value = 'bn';
        }

        function setupEventListeners() {
            [searchInputEl, categoryFilterEl, lang1SelectEl, lang2SelectEl].forEach(el => {
                el.addEventListener('input', filterAndDisplayPhrases);
                el.addEventListener('change', filterAndDisplayPhrases);
            });
            
            navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    navTabs.forEach(t => t.classList.remove('active'));
                    pages.forEach(p => p.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.page).classList.add('active');
                });
            });
        }

        function speak(text) {
            if (synth.speaking) synth.cancel();
            if (text) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'de-DE';
                utterance.rate = 0.9;
                synth.speak(utterance);
            }
        }
        window.speechSynthesis.getVoices();
    </script>
</body>
</html>
